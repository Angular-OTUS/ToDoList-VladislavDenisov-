<main>
    <header>
        <h1>Todo list</h1>
    </header>
    @if (isLoading) {
        <app-loading-spinner></app-loading-spinner>
    } @else {
        <section>
            <mat-form-field>
                <mat-select [(value)]="selectedOption">
                    @for (option of itemSelectOptions; track option) {
                        <mat-option [value]="option">
                            {{ option }}
                        </mat-option>
                    }
                </mat-select>
            </mat-form-field>
        </section>
        <section class="task-list">
            <ul class="task-list__list">
                @for (toDoListItem of filteredToDoList; track toDoListItem) {
                    <app-to-do-list-item
                        [item]="toDoListItem"
                        [isSelected]="getIsItemSelected(toDoListItem.id)"
                        [isChecked]="getIsItemChecked(toDoListItem.id)"
                        (deleteItemEvent)="deleteItem($event)"
                        (setSelectedItemIdEvent)="setSelectedItemId($event); setIsEditing(false)"
                        (setIsEditingEvent)="setIsEditing($event); setEditItemFormDefaultValue()"
                        (toggleItemStatusEvent)="toggleItemStatus($event)"
                    ></app-to-do-list-item>
                }
            </ul>
            @if (selectedItem && !isEditing) {
                <app-to-do-list-item-description
                    class="task-list__description"
                    [toDoListItem]="selectedItem"
                ></app-to-do-list-item-description>
            }
            @if (selectedItem && isEditing) {
                <form #formDirective="ngForm" [formGroup]="editItemForm" class="edit-item-form" (ngSubmit)="onEditItemFormSubmit(formDirective)">
                    <mat-form-field>
                        <input 
                            matInput 
                            type="text" 
                            placeholder="New todo item name" 
                            name="editName"
                            [formControl]="editItemForm.controls.name"
                        />
                        @if (editItemForm.controls.name.hasError('required') || editItemForm.controls.name.hasError('whitespace')) {
                            <mat-error>Name is <strong>required</strong></mat-error>
                        }
                    </mat-form-field>
                    <div class="edit-item-form__button-group">
                        <app-button
                            type="button"
                            appCustomTooltip="Cancel editing" 
                            [buttonType]="'stroked'"
                            (click)="cancelEditing(formDirective)"
                        >
                            Cancel
                        </app-button>
                        <app-button
                            type="submit"
                            class="button__positive"
                            appCustomTooltip="Save new item todo" 
                            [disabled]="editItemForm.controls.name.invalid"
                        >
                            Save
                        </app-button>
                    </div>
                </form>
            }
        </section>

        <section>
            <app-to-do-create-item />
        </section>
    }
</main>
